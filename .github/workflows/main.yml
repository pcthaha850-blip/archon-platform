name: ARCHON PRIME CI

on:
  push:
      branches: [ main, develop ]
        pull_request:
            branches: [ main ]

            jobs:
              test:
                  runs-on: ubuntu-latest
                      strategy:
                            matrix:
                                    python-version: ['3.10', '3.11', '3.12']

                                        steps:
                                            - uses: actions/checkout@v4

                                                - name: Set up Python ${{ matrix.python-version }}
                                                      uses: actions/setup-python@v5
                                                            with:
                                                                    python-version: ${{ matrix.python-version }}

                                                                        - name: Cache pip dependencies
                                                                              uses: actions/cache@v4
                                                                                    with:
                                                                                            path: ~/.cache/pip
                                                                                                    key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
                                                                                                            restore-keys: |
                                                                                                                      ${{ runner.os }}-pip-
                                                                                                                      
                                                                                                                          - name: Install dependencies
                                                                                                                                run: |
                                                                                                                                        python -m pip install --upgrade pip
                                                                                                                                                pip install -r requirements.txt
                                                                                                                                                
                                                                                                                                                    - name: Run tests with pytest
                                                                                                                                                          run: |
                                                                                                                                                                  pytest tests/ -v --tb=short
                                                                                                                                                                  
                                                                                                                                                                    lint:
                                                                                                                                                                        runs-on: ubuntu-latest
                                                                                                                                                                            steps:
                                                                                                                                                                                - uses: actions/checkout@v4
                                                                                                                                                                                
                                                                                                                                                                                    - name: Set up Python
                                                                                                                                                                                          uses: actions/setup-python@v5
                                                                                                                                                                                                with:
                                                                                                                                                                                                        python-version: '3.11'
                                                                                                                                                                                                        
                                                                                                                                                                                                            - name: Install linting tools
                                                                                                                                                                                                                  run: |
                                                                                                                                                                                                                          pip install flake8 black isort mypy
                                                                                                                                                                                                                          
                                                                                                                                                                                                                              - name: Check formatting with black
                                                                                                                                                                                                                                    run: |
                                                                                                                                                                                                                                            black --check --diff archon_prime/ tests/
                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                - name: Check imports with isort
                                                                                                                                                                                                                                                      run: |
                                                                                                                                                                                                                                                              isort --check-only --diff archon_prime/ tests/
                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                  - name: Lint with flake8
                                                                                                                                                                                                                                                                        run: |
                                                                                                                                                                                                                                                                                flake8 archon_prime/ tests/ --max-line-length=100 --ignore=E501,W503
                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                  security:
                                                                                                                                                                                                                                                                                      runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                          steps:
                                                                                                                                                                                                                                                                                              - uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                  - name: Set up Python
                                                                                                                                                                                                                                                                                                        uses: actions/setup-python@v5
                                                                                                                                                                                                                                                                                                              with:
                                                                                                                                                                                                                                                                                                                      python-version: '3.11'
                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                          - name: Install security tools
                                                                                                                                                                                                                                                                                                                                run: |
                                                                                                                                                                                                                                                                                                                                        pip install bandit safety
                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                            - name: Security check with bandit
                                                                                                                                                                                                                                                                                                                                                  run: |
                                                                                                                                                                                                                                                                                                                                                          bandit -r archon_prime/ -ll
                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                              - name: Check dependencies for vulnerabilities
                                                                                                                                                                                                                                                                                                                                                                    run: |
                                                                                                                                                                                                                                                                                                                                                                            pip install -r requirements.txt
                                                                                                                                                                                                                                                                                                                                                                                    safety check
